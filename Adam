--[[
	WARNING: Heads up! This script has not been verified by ScriptBlox. Use at your own risk!
]]
-- Auto Farm for ST: Blockade Reboot
-- Smooth Lock-on, Behind Target (5 studs), Stable Float (no bounce)
-- WARNING: Use at your own risk!

local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/bloodball/-back-ups-for-libs/main/wizard"))()
local Window = Library:NewWindow("Auto Farm")
local Section = Window:NewSection("Options")

local RunService = game:GetService("RunService")

local autoFarmActive = false
local followConnection

Section:CreateToggle("Auto Farm", function(value)
	autoFarmActive = value
	if autoFarmActive then
		startAutoFarm()
	else
		if followConnection then
			followConnection:Disconnect()
			followConnection = nil
		end
	end
end)

function startAutoFarm()
	task.spawn(function()
		while autoFarmActive do
			pcall(function()
				local player = game.Players.LocalPlayer
				local char = player.Character or player.CharacterAdded:Wait()
				local hrp = char:FindFirstChild("HumanoidRootPart")

				if not hrp then return end

				local target = findClosestAliveNPC(5000, hrp)
				if target and target:FindFirstChild("HumanoidRootPart") then
					local targetHRP = target.HumanoidRootPart

					-- ล็อกให้อยู่ "หลังมอน" 5 studs และสูงขึ้นเล็กน้อย 1.5
					local offset = Vector3.new(0, 1.5, 5)

					if followConnection then
						followConnection:Disconnect()
					end

					-- ใช้ Heartbeat ล็อกตำแหน่งแบบเฟรมต่อเฟรม (ไม่ให้เด้ง)
					followConnection = RunService.Heartbeat:Connect(function()
						if not autoFarmActive or not target or not target:FindFirstChild("HumanoidRootPart") then
							followConnection:Disconnect()
							followConnection = nil
							return
						end

						local finalCFrame = targetHRP.CFrame * CFrame.new(offset)
						hrp.CFrame = finalCFrame
					end)

					attackNPC(target)
				end
			end)
			task.wait(0.2)
		end
	end)
end

function attackNPC(npc)
	pcall(function()
		if not (npc and npc:FindFirstChild("Humanoid") and npc.Humanoid.Health > 0) then return end

		local player = game.Players.LocalPlayer
		local char = player.Character
		if not char then return end

		local tool = char:FindFirstChildOfClass("Tool")
		if tool then
			tool:Activate()
		end

		local gunEvent = game.ReplicatedStorage:FindFirstChild("GunFireEvent")
		if gunEvent then
			gunEvent:FireServer(npc.HumanoidRootPart.Position)
		end

		local skillEvent = player.PlayerScripts:FindFirstChild("SkillEvent")
		if skillEvent then
			skillEvent:FireServer("Skill1", npc.HumanoidRootPart.Position)
		end
	end)
end

function findClosestAliveNPC(maxDistance, part)
	local lastDist = maxDistance
	local closest = nil

	for _, v in pairs(workspace:GetDescendants()) do
		if v:IsA("Model") and v:FindFirstChild("Humanoid") and v:FindFirstChild("HumanoidRootPart") then
			local hum = v:FindFirstChild("Humanoid")
			if hum and hum.Health > 0 and not game.Players:GetPlayerFromCharacter(v) then
				local thisDist = (v.HumanoidRootPart.Position - part.Position).Magnitude
				if thisDist < lastDist then
					closest = v
					lastDist = thisDist
				end
			end
		end
	end
	return closest
end
